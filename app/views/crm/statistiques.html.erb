<h1>Statistiques</h1>
<div class="flex">
  <div class="stat_bloc">
    <h2>Commandes en cours</h2>
    <p>Total HT : <%= @orders.where(state:"En attente de paiement").sum(:amount_ht_cents)/100%> <%= currency_symbol %> FAUX</p>
    <p>Nombre de commandes : <%= @orders.where(state:"En attente de paiement").count %>FAUX</p>
  </div>

  <div class="stat_bloc">
    <h2>CA généré <%= Date.today.year %></h2>
    <p>Total HT : <%= Money.new(@amount_n_payed).format.delete_prefix('€') %><%= currency_symbol %></p>
    <p>Nombre de commandes : <%= @orders.where(state:"Payée").count %></p>
  </div>
  <div class="stat_bloc">
    <h2>Nombre de clients</h2>
    <p>Nouveaux clients <%= Date.today.year %> :</p>
    <p>Total clients :</p>
  </div>
  <div class="stat_bloc">
    <h2>Prospects</h2>
    <p>Nouveaux prospects :</p>
    <p>En cours de traitement :</p>
    <p title="Nombre de prospects assignés et traîtés au cours de l'année">Total prospects traités <%= Date.today.year %> :</p>
  </div>

</div>
<div class="flex">
  <div class="stat_bloc">
    <h2>Clients n'ayant pas commandé :</h2>
    <p>Depuis 6 mois :</p>
    <p>Depuis 9 mois :</p>
    <p>Depuis 12 mois et plus :</p>
  </div>
</div>

<h3>Nombre de prospects <%= Date.today.year %></h3>

<%= column_chart @data_prospects, stacked:true,colors: ["#3498DB", "#F5B041","#F1948A","#73C6B6"],dataset: {borderWidth: 1},width: "800px", height: "300px" %>
<hr>
<h3>Commandes <%= Date.today.year %></h3>
<p>Objectif : <progress max="100" value="70"></progress></p>
  <%= column_chart @data_commandes,colors: ["#3498DB", "#F5B041","#F1948A","#73C6B6"],dataset: {borderWidth: 1},width: "800px", height: "300px" %>
<br>
<table class="table_cmds_stats">
<thead>
  <tr>
    <th><%= Date.today.year %></th>
    <th>Janvier</th>
    <th>Février</th>
    <th>Mars</th>
    <th>Avril</th>
    <th>Mai</th>
    <th>Juin</th>
    <th>Juillet</th>
    <th>Août</th>
    <th>Septembre</th>
    <th>Octobre</th>
    <th>Novembre</th>
    <th>Décembre</th>
    <th>Totaux</th>
    <th>Totaux N-1</th>
  </tr>
</thead>
<tbody>
<tr>
<td title="Nombre de commandes payées pour du réassort sur l'année">Réassorts</td>
<% @amount_hash[(Date.today.year).to_s].keys.each_with_index do |mois,index| %>
  <td><%= Money.new(@amount_hash[(Date.today.year).to_s][mois]["reassort"]).format.delete_prefix('€') %><%= currency_symbol %></td>
<% end %>
<td><%= Money.new(@total_facture_n).format.delete_prefix('€') %><%= currency_symbol %></td>
<td style="background-color:lightgrey;"></td>
</tr>
<tr>
<td title="Nombre de commandes payées pour des ouvertures de compte sur l'année">Ouvertures</td>
<% @ouvert_mois_n.each do |mois| %>
  <td><%= mois[1] %><%= currency_symbol %></td>
<% end %>
<td><%= Money.new(@ouvert_total_n).format.delete_prefix('€') %><%= currency_symbol %></td>
<td><%= Money.new(@ouvert_total_n_1).format.delete_prefix('€') %><%= currency_symbol %></td>
</tr>
</tbody>

<tr class="border_none">
  <td colspan="15" height="20"></td>
</tr>

<tbody>
<td title="Montant des commandes passées payées ou non sur l'année">Commandes</td>
<% @amount_hash[(Date.today.year).to_s].keys.each_with_index do |mois,index| %>
  <td><%= Money.new(@amount_hash[(Date.today.year).to_s][mois]["all"]).format.delete_prefix('€') %><%= currency_symbol %></td>
<% end %>
<td><%= Money.new(@amount_n).format.delete_prefix('€') %><%= currency_symbol %></td>
<td><%= Money.new(@amount_n_1).format.delete_prefix('€') %><%= currency_symbol %></td>
</tr>
<tr>
<td title="Montant des commandes avec l'état payé sur l'année">CA réel</td>
<% @amount_hash[(Date.today.year).to_s].keys.each_with_index do |mois,index| %>
  <td><%= Money.new(@amount_hash[(Date.today.year).to_s][mois]["Payée"]).format.delete_prefix('€') %><%= currency_symbol %></td>
<% end %>

<td><%= Money.new(@amount_n_payed).format.delete_prefix('€') %><%= currency_symbol %></td>
<td><%= Money.new(@amount_n_1_payed).format.delete_prefix('€') %><%= currency_symbol %></td>
</tr>
<tr>
<td title="Montant des commandes avec l'état payé pour l'année N-1">CA réel <%= Date.today.year-1%></td>
<% @amount_hash[(Date.today.year-1).to_s].keys.each_with_index do |mois,index| %>
  <td><%= Money.new(@amount_hash[(Date.today.year-1).to_s][mois]["Payée"]).format.delete_prefix('€') %><%= currency_symbol %></td>
<% end %>
<td><%= Money.new(@amount_n_1_payed).format.delete_prefix('€') %><%= currency_symbol %></td>
<td style="background-color:lightgrey;"></td>
</tr>
</tbody>
</table>
<br>
<hr>
<h3>Volume d'affaires par client</h3>
<div class="flex">
  <%= scatter_chart @data_nuage_n,xtitle: "Nombre de commandes #{Date.today.year}", ytitle: "CA généré ht payé",width: "50%", height: "300px" %>
  <%= scatter_chart @data_nuage_n_1,xtitle: "Nombre de commandes #{Date.today.year-1}", ytitle: "CA généré ht payé",width: "50%", height: "300px" %>
</div>
<hr>

<h1 style="color:red;">A ignorer</h1>
<h3>Nombre de nouveaux clients</h3>
<%= column_chart @prospects.group_by_day(:date_prospect).count %>
<h3>Nombre de clients</h3>
<%= column_chart @prospects.group_by_day(:date_prospect).count %>
<h3>Nombre de commandes passées</h3>
<%= column_chart @orders.group_by_month(:custom_date).count %>
<%= scatter_chart @orders.group_by_month(:custom_date).count %>

<% sample1 = [
  {
    name:"2023",
    data:[["2023",["Camille Becht",1500]]]
  },
  {
    name:"2024",
    data:[["2024",["Camille Becht",800]]]
  }
]
%>
<% sample2 = [[size: "10km",
    population:"10 000"],
  [size: "20km",
    population:"20 000"
  ]
]%>


<h3>CA généré 2024</h3>
<%= column_chart @prospects.group_by_day(:date_prospect).count %>
<h3>Status des prospects</h3>
<%= column_chart @prospects.group(:statut).count %>
